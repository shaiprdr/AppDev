<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking Page - RREENNTTACAR</title>
  <link rel="stylesheet" href="booking.css" />
</head>
<body>
  <header>
    <div class="navbar">
      <div class="brand">
        <img src="IMAGES/logo.png" alt="Logo" class="logo-img" />
        <span class="logo-text">RREENNTTACAR</span>
      </div>
      <nav>
        <ul class="nav-links">
          <li><a href="landingpage.html"><img src="IMAGES/home.png" alt="home" class="nav-icon"></a></li>
          <li><a href="userdashboard.html"><img src="IMAGES/people.png" alt="profile" class="nav-icon"></a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="booking-hero">
    <video autoplay muted loop class="booking-hero-video">
      <source src="IMAGES/7154212-hd_1920_1080_25fps.mp4" type="video/mp4" />
    </video>
    <div class="video-overlay"></div>
    <div class="booking-hero-overlay">
      <h1>Find Your Perfect Ride</h1>
      <p>Quick and easy booking</p>
    </div>

    <div class="booking-bar-overlay">
      <div class="booking-bar">
        <div class="booking-grid">
          <div class="input-group">
            <input type="date" id="rental-start" name="rental-start-date" required />
            <label for="rental-start">Rental Start Date</label>
          </div>
          <div class="input-group">
            <input type="date" id="rental-end" name="rental-end-date" required />
            <label for="rental-end">Rental End Date</label>
          </div>
          <div class="input-group">
            <input
              type="text"
              id="rental-duration-display"
              name="rental-duration"
              placeholder="7 - 31 days only"
              readonly
            />
            <label for="rental-duration-display">Rental Duration (days)</label>
          </div>
          <div class="input-group">
            <select id="return-area" required>
              <option value="" disabled selected hidden>----</option>
              <option>Caloocan City Branch</option>
              <option>Las Pinas City Branch</option>
              <option>Makati City Branch</option>
              <option>Malabon City Branch</option>
              <option>Mandaluyong City Branch</option>
              <option>Marikina City Branch</option>
              <option>Manila City Branch</option>
              <option>Muntinlupa City Branch</option>
              <option>Navotas City Branch</option>
              <option>Paranaque City Branch</option>
              <option>Pasay City Branch</option>
              <option>Pasig City Branch</option>
              <option>Quezon City Branch</option>
              <option>San Juan City Branch</option>
              <option>Taguig City Branch</option>
              <option>Valenzuela City Branch</option>
              <option>Municipality of Pateros Branch</option>
              <option>Cavite Branch</option>
              <option>Laguna Branch</option>
              <option>Batangas Branch</option>
              <option>Rizal Branch</option>
              <option>Quezon Province Branch</option>
            </select>
            <label for="return-area">From what branch</label>
          </div>
          <div class="input-group delivery-address">
            <input
              type="text"
              id="delivery-address"
              name="delivery-address"
              placeholder="Your delivery address"
              required
            />
            <label for="delivery-address">Car Delivery Address</label>
          </div>
          <div class="input-group">
            <input type="date" id="delivery-date" name="delivery-date" required />
            <label for="delivery-date">Delivery Date</label>
          </div>

          <div class="input-group">
            <input type="time" id="delivery-time" name="delivery-time" required />
            <label for="delivery-time">Delivery Time</label>
          </div>

          <div class="input-group return-method-wrapper">
            <div class="return-method-input">
              <label for="return-method">Return Method</label>
              <select id="return-method" required>
                <option value="" disabled selected hidden>----</option>
                <option value="return-area">Return to Branch</option>
                <option value="delivery-address">Pick up at same address</option>
                <option value="return-address">Pick up at different location</option>
              </select>
            </div>
          </div>

          <div class="input-group return-address" style="display: none;">
            <label for="return-address">Return Address</label>
            <input
              type="text"
              id="return-address"
              name="return-address"
              placeholder="Enter return address"
            />
          </div>

          <div class="input-group">
            <input type="date" id="return-date" name="return-date" required />
            <label for="return-date">Return Date</label>
          </div>


          <div class="input-group">
            <input type="time" id="return-time" name="return-time" required />
            <label for="return-time">Return Time</label>
          </div>
          <div class="input-group">
            <button type="button" onclick="saveBookingDetails()" id="save-button" class="save-btn">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="booking-sum-container">
    <div class="booking-summary-container">
      <div class="summary-flex-container">
        <!-- Not sure kung mas okay tanggalin na lang tong slider na to at palitan ng single image na lang -->
        <div class="car-slider" id="car-slider">
          <button class="prev" onclick="prevSlide()">❮</button>
          <button class="next" onclick="nextSlide()">❯</button>
        </div>

        <div id="booking-summary">
          <h2>Booking Summary</h2>
          <p><strong>Car Model:</strong> <span id="summary-carModel"></span></p>
          <p><strong>Rental Duration:</strong> <span id="summary-rentalDuration"></span></p>
          <p><strong>Branch:</strong> <span id="summary-branch"></span></p>
          <p><strong>Delivery Location:</strong> <span id="summary-delivery"></span></p>
          <p><strong>Return Location:</strong> <span id="summary-return"></span></p>
          <p><strong>Start Date:</strong> <span id="summary-startDate"></span></p>
          <p><strong>End Date:</strong> <span id="summary-endDate"></span></p>

          <div class="acknowledgment-section">
            <label
              ><input type="checkbox" id="agree-terms" />
              I have read and agreed to the rental terms and privacy policy.</label
            ><br />
            <label
              ><input type="checkbox" id="agree-contact" />
              I understand the car owner will contact me for further coordination.</label
            >
          </div>
          <div class="booking-actions">
            <a
              href="payment.html"
              class="pay-now-button"
              id="pay-now-button"
              onclick="return validateAgreement()"
              >PAY NOW</a
            >
            <p class="note">
              After payment, the car owner will contact you to confirm the rental and finalize pickup
              details.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  
  <div id="rental-terms-modal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Heads Up!</h2>
      <ul>
        <li><strong>Delivery Date:</strong> We deliver your booked car <b>one day before</b> your rental start date. (e.g., Booked for 15/05/2025 → Delivered on 14/05/2025)</li>
        <li><strong>Return Date:</strong> Please return the car <b>the day after</b> your rental end date. (e.g., Rental ends 31/05/2025 → Return on 01/06/2025)</li>
        <li><strong>Time:</strong> Delivery and return times are <b>flexible</b>. We're available <b>24/7</b> to serve you!</li>
      </ul>
      <p>For more information, <a href="terms-and-agreement.html" target="_blank">click here</a>.</p>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 RREENNTTACAR. All rights reserved.</p>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("rental-terms-modal");
    const modalContent = modal.querySelector(".modal-content");
    const closeBtn = document.querySelector(".close-button");

    
    function openModal() {
      modal.style.display = "block";
      
      
      modalContent.style.animation = "none";
      void modalContent.offsetWidth; 
      modalContent.style.animation = "slideUp 0.4s ease forwards";
    }

    
    function closeModal() {
      modal.style.display = "none";
    }

    
    openModal();

  
    closeBtn.addEventListener("click", closeModal);


    window.addEventListener("click", (event) => {
      if (event.target === modal) {
        closeModal();
      }
    });
  });
  </script>

  <script>
    const returnMethodSelect = document.getElementById("return-method");
    const returnAreaSelect = document.getElementById("return-area");
    const deliveryAddress = document.getElementById("delivery-address");
    const returnAddressGroup = document.querySelector(".return-address");
    const returnAddressInput = document.getElementById("return-address");

    const rentalStart = document.getElementById("rental-start");
    const rentalEnd = document.getElementById("rental-end");
    const rentalDurationDisplay = document.getElementById("rental-duration-display");

    const summaryCarModel = document.getElementById("summary-carModel");
    const summaryRentalDuration = document.getElementById("summary-rentalDuration");
    const summaryBranch = document.getElementById("summary-branch");
    const summaryDelivery = document.getElementById("summary-delivery");
    const summaryReturn = document.getElementById("summary-return");
    const summaryStartDate = document.getElementById("summary-startDate");
    const summaryEndDate = document.getElementById("summary-endDate");

    // Ito ulittt. Tanngalin na lang ba to???
    let sliderIndex = 0;
    let sliderImages = [];

    function loadCarDetails() {
      const carDataJSON = localStorage.getItem("selectedCar");
      if (!carDataJSON) {
        alert("No car selected. Redirecting to car listing page.");
        window.location.href = "carlisting.html";
        return;
      }
      const carData = JSON.parse(carDataJSON);

      summaryCarModel.textContent = carData.name || carData.model || "N/A";

      // Hmmm??? Di na kasi keri ng mata ko kaya di ko na pinagtiyagaan i-figure out
      sliderImages = carData.images || [carData.image];
      if (!Array.isArray(sliderImages)) sliderImages = [sliderImages];

      setupSliderImages();
    }

    function setupSliderImages() {
      const sliderContainer = document.getElementById("car-slider");
      [...sliderContainer.querySelectorAll("img")].forEach((img) => img.remove());

      sliderImages.forEach((imgSrc, idx) => {
        const img = document.createElement("img");
        img.src = imgSrc;
        img.alt = "Car Image " + (idx + 1);
        img.classList.add("slide-image");
        if (idx !== sliderIndex) img.style.display = "none";
        sliderContainer.insertBefore(img, sliderContainer.querySelector(".prev"));
      });
    }

    function prevSlide() {
      sliderIndex = (sliderIndex - 1 + sliderImages.length) % sliderImages.length;
      updateSlider();
    }

    function nextSlide() {
      sliderIndex = (sliderIndex + 1) % sliderImages.length;
      updateSlider();
    }

    function updateSlider() {
      const images = document.querySelectorAll("#car-slider img.slide-image");
      images.forEach((img, idx) => {
        img.style.display = idx === sliderIndex ? "block" : "none";
      });
    }

    function saveBookingDetails() {
      if (!rentalStart.value || !rentalEnd.value) {
        alert("Please select rental start and end dates.");
        return;
      }


      const startDate = new Date(rentalStart.value);
      const endDate = new Date(rentalEnd.value);
      const diffTime = endDate - startDate;
      const rentalDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
    
      if (rentalDays < 7 || rentalDays > 31) {
        alert("Rental duration must be between 7 and 31 days.");
        return;
      }

      const agreeTerms = document.getElementById("agree-terms").checked;
      const agreeContact = document.getElementById("agree-contact").checked;
      if (!agreeTerms || !agreeContact) {
        alert("Please agree to the terms and privacy policy, and acknowledge contact terms.");
        return;
      }
    
      const selectedCar = JSON.parse(localStorage.getItem("selectedCar"));
      if (!selectedCar) {
        alert("No car selected. Please select a car first.");
        window.location.href = "carlisting.html";
        return;
      }
    
      const bookingDetails = {
        ...selectedCar,
        rentalStartDate: rentalStart.value,
        rentalEndDate: rentalEnd.value,
        rentalDays: rentalDays,
        branch: returnAreaSelect.value,
        deliveryAddress: deliveryAddress.value,
        deliveryDate: document.getElementById("delivery-date").value,
        deliveryTime: document.getElementById("delivery-time").value,
        returnMethod: returnMethodSelect.value,
        returnAddress: returnAddressInput.value || "",
        returnDate: document.getElementById("return-date").value,
        returnTime: document.getElementById("return-time").value,
        deliveryFee: 500,
      };

      localStorage.setItem("bookingDetails", JSON.stringify(bookingDetails));

      window.location.href = "payment.html";
    }

    function calculateRentalDuration() {
      if (rentalStart.value && rentalEnd.value) {
        const start = new Date(rentalStart.value);
        const end = new Date(rentalEnd.value);
        const diffTime = end.getTime() - start.getTime();
        const diffDays = diffTime / (1000 * 3600 * 24) + 1;
        if (diffDays >= 7 && diffDays <= 31) {
          rentalDurationDisplay.value = diffDays;
        } else {
          rentalDurationDisplay.value = "";
        }
        updateSummaryDatesAndDuration();
      }
    }

    function updateSummaryDatesAndDuration() {
      summaryStartDate.textContent = rentalStart.value || "N/A";
      summaryEndDate.textContent = rentalEnd.value || "N/A";
      summaryRentalDuration.textContent = rentalDurationDisplay.value
        ? rentalDurationDisplay.value + " days"
        : "N/A";
    }

    returnMethodSelect.addEventListener("change", () => {
      if (returnMethodSelect.value === "return-address") {
        returnAddressGroup.style.display = "block";
        returnAddressInput.required = true;
        summaryReturn.textContent = returnAddressInput.value || "N/A";
      } else {
        returnAddressGroup.style.display = "none";
        returnAddressInput.required = false;
        if (returnMethodSelect.value === "return-area") {
          summaryReturn.textContent = returnAreaSelect.value || "N/A";
        } else if (returnMethodSelect.value === "delivery-address") {
          summaryReturn.textContent = deliveryAddress.value || "N/A";
        } else {
          summaryReturn.textContent = "N/A";
        }
      }
    });

    returnAreaSelect.addEventListener("change", () => {
      summaryBranch.textContent = returnAreaSelect.value || "N/A";
      if (returnMethodSelect.value === "return-area") {
        summaryReturn.textContent = returnAreaSelect.value || "N/A";
      }
    });

    deliveryAddress.addEventListener("input", () => {
      summaryDelivery.textContent = deliveryAddress.value || "N/A";
      if (returnMethodSelect.value === "delivery-address") {
        summaryReturn.textContent = deliveryAddress.value || "N/A";
      }
    });

    returnAddressInput.addEventListener("input", () => {
      if (returnMethodSelect.value === "return-address") {
        summaryReturn.textContent = returnAddressInput.value || "N/A";
      }
    });

    rentalStart.addEventListener("change", () => {
      calculateRentalDuration();
    });
    rentalEnd.addEventListener("change", () => {
      calculateRentalDuration();
    });

    function validateAgreement() {
      const agreeTerms = document.getElementById("agree-terms").checked;
      const agreeContact = document.getElementById("agree-contact").checked;
      if (!agreeTerms || !agreeContact) {
        alert("Please agree to all terms and conditions before proceeding.");
        return false;
      }
      if (!saveBookingDetails()) {
        return false;
      }
      return true;
    }

    function saveBookingDetails() {
      if (!rentalStart.value) {
        alert("Please select a rental start date.");
        return false;
      }
      if (!rentalEnd.value) {
        alert("Please select a rental end date.");
        return false;
      }
      if (!rentalDurationDisplay.value) {
        alert("Rental duration must be between 7 and 31 days.");
        return false;
      }
      if (!returnAreaSelect.value) {
        alert("Please select a branch.");
        return false;
      }
      if (!deliveryAddress.value.trim()) {
        alert("Please enter a delivery address.");
        return false;
      }
      if (!returnMethodSelect.value) {
        alert("Please select a return method.");
        return false;
      }
      if (returnMethodSelect.value === "return-address" && !returnAddressInput.value.trim()) {
        alert("Please enter a return address.");
        return false;
      }
      const deliveryDate = document.getElementById("delivery-date").value;
      if (!deliveryDate) {
        alert("Please select a delivery date.");
        return false;
      }
      const deliveryTime = document.getElementById("delivery-time").value;
      if (!deliveryTime) {
        alert("Please select a delivery time.");
        return false;
      }
      const returnDate = document.getElementById("return-date").value;
      if (!returnDate) {
        alert("Please select a return date.");
        return false;
      }
      const returnTime = document.getElementById("return-time").value;
      if (!returnTime) {
        alert("Please select a return time.");
        return false;
      }

      const bookingDetails = {
        rentalStartDate: rentalStart.value,
        rentalEndDate: rentalEnd.value,
        rentalDuration: rentalDurationDisplay.value,
        branch: returnAreaSelect.value,
        deliveryAddress: deliveryAddress.value.trim(),
        deliveryDate,
        deliveryTime,
        returnMethod: returnMethodSelect.value,
        returnAddress:
          returnMethodSelect.value === "return-address" ? returnAddressInput.value.trim() : null,
        returnDate,
        returnTime,
      };

      localStorage.setItem("bookingDetails", JSON.stringify(bookingDetails));
      alert("Booking details saved successfully!");
      return true;
    }

    function init() {
      loadCarDetails();
      updateSummaryDatesAndDuration();

      summaryBranch.textContent = returnAreaSelect.value || "N/A";
      summaryDelivery.textContent = deliveryAddress.value || "N/A";
      summaryReturn.textContent = returnAreaSelect.value || "N/A";

      if (returnMethodSelect.value === "return-address") {
        returnAddressGroup.style.display = "block";
        returnAddressInput.required = true;
      } else {
        returnAddressGroup.style.display = "none";
        returnAddressInput.required = false;
      }
    }

    window.onload = init;
  </script>
</body>
</html>
